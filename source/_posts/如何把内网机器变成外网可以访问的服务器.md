---
title: 如何把内网机器变成外网可以访问的服务器
date: 2017-03-25 17:35:22
categories: 综合
tags:
- Linux
---

### 环境准备
1. 需要一台内网机器（性能越强越好）【192.168.1.100】
2. 一个有公网IP的路由器，或者移动内网或者电信内网IP都可以【101.245.198.155】
3. 一个公网服务器（不需要内存太大，1G足够）【121.40.66.176】

> 路由器和公网服务器要能互通，如果不通，可以尝试重启路由器，重启的作用是换一个新的ip，也许就通了

<!-- more -->

### 步骤
1. 把服务器部署在内网机器上，比如我的博客在内网可以访问:192.168.1.100:8088
2. 登录路由器，配置“端口转发”，把请求路由器8088端口的请求，转发到请求192.168.1.100:8088
3. 登录公网服务器，执行远程端口转发命令：

```
ssh -C -f -N -g -L 80:101.245.198.155:8088 kyg@101.245.198.155
```

表示，请求公网80端口的请求，会被转发到路由器（101.245.198.155）的8088端口

### 保持转发链接不中断（自动重连）
查看任务  
`crontab -l`

创建任务  
`crontab -e`

每小时重连一次  
`0 * * * * sh conn.sh`